extends layout
block content
 div(class="container" style="margin-top: 15px")
    div(class="row justify-content-center")
        div(class="col-md-6")
           p(class="display-4") Register
           form
                div(class="form-group")
                    label() Username
                    input(type="text" id="username" class="form-control" placeholder="Enter username")
                div(class="form-group")
                    label() Email Address
                    input(type="email" id="email" class="form-control" placeholder="Enter email")
                    small(class="form-text text-muted") We'll never share your email with anyone else
                div(class="row")
                    div(class="col-md-6")
                        div(class="form-group")
                            label() Password
                            input(type="password" id="password" class="form-control" placeholder="Enter password")
                            small(class="form-text text-muted") Make sure you choose a good one 
                    div(class="col-md-6")
                        div(class="form-group")
                            label() Confirm Password
                            input(type="password" id="passwordConf" class="form-control" placeholder="Enter password" onkeyup="checkMatching()")
                        div(class="form-group-append" id="match")
                button(class="btn btn-primary" type="button" onclick="submitR()") Submit
                
    block scripts
        script(src="/javascripts/mal/api.js")
        script.
            const acc = (window.location.href.includes('localhost')) ? io('http://localhost:3000/acc') : io('http://76.64.123.119:3000/acc');
            function submitR() {
                acc.on('register/success', () => {
                    document.querySelector('#alerts').innerHTML += `<div class="alert alert-success alert-dismissible fade show" role="alert">Registration Complete<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>`
                 });
                acc.on('register/error', (err) => {
                    document.querySelector('#alerts').innerHTML += `<div class="alert alert-danger alert-dismissible fade show" role="alert">${err.message}<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>`
                });
                if(checkMatching()) {
                    acc.emit('register', {username: document.querySelector('#username').value, email: document.querySelector('#email').value, password:document.querySelector('#password').value, passwordConf: document.querySelector('#passwordConf').value});
                }
            }
            function checkMatching() {
                let match = document.querySelector('#match');
                if(document.querySelector('#password').value == document.querySelector('#passwordConf').value) {
                    match.innerHTML = `<small class="form-text text-muted">Passwords match</small>`
                    return true;
                }else {
                    match.innerHTML = `<small class="form-text text-muted">Passwords do not match</small>`
                    return false;
                }
            }